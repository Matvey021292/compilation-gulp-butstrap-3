function init(){canvas=document.getElementById("cgraph"),ctx=canvas.getContext("2d"),bt_grn=document.getElementsByClassName("btn__green")[0],bt_red=document.getElementsByClassName("btn__red")[0],vid_grad=document.getElementsByClassName("vidget__gradient")[0],$("#restart_button a").on("click",function(){$("#vidget_results").fadeOut(400),bt_grn.parentNode.style.display="block",vid_grad.style.display="block"}),(qbtns=[])[0]=document.getElementsByClassName("vidget__list")[0].childNodes[1],qbtns[1]=document.getElementsByClassName("vidget__list")[0].childNodes[3],qbtns[2]=document.getElementsByClassName("vidget__list")[0].childNodes[5],qbtns[3]=document.getElementsByClassName("vidget__list")[0].childNodes[7],window.addEventListener("resize",onresize),bt_grn.onclick=function(){btn_click(0)},bt_red.onclick=function(){btn_click(1)},qbtns[0].onclick=function(){set_instrument(0)},qbtns[1].onclick=function(){set_instrument(1)},qbtns[2].onclick=function(){set_instrument(2)},qbtns[3].onclick=function(){set_instrument(3)},tickspd=.5,line.points=[0],line.last=line.points[0],line.t=1,line.val=1,line.mx=1,line.max=40/tickspd,line.fix=999,line.fix_anim=0,line.dr=0,line.color=[220,220,220],line.pnt_color=[20,220,20],line.fix_color=[160,0,0],(quotes=[1.06535,1224.5,128.82,52.23]).current=0,grid.ccount_w=8,grid.ccount_h=4,grid.dx=0,now=Date.now(),timer.t=15,timer.visible=!1,line.now=Date.now(),onresize(),start()}function start(){line.anim=TweenLite.from(line,tickspd,{t:0,onComplete:function(){line.push_point(line.val),line.anim.restart()}}),loop()}function set_instrument(e){999==line.fix&&(now=Date.now(),quotes.current=e,line.points=[.8*(Math.random()*ch-ch/2)])}function btn_click(e){line.val=1,0==e?(line.dr=5,TweenLite.to(line,4,{val:1,dr:-15,delay:8})):(line.dr=-5,TweenLite.to(line,4,{val:1,dr:15,delay:8})),$(".vidget__gradient, .vidget__graph-buttons").fadeOut(400),line.max=300,line.fix=line.last,timer.x=line.points.length-2,timer.visible=!0,TweenLite.to(line,1,{fix_anim:1}),TweenLite.to(timer,15,{t:0,ease:Power0.easeIn,onComplete:function(){$("#vidget_results").fadeIn(400),restart()}})}function restart(){line.points=[0],line.last=line.points[0],line.t=1,line.val=1,line.mx=1,line.max=40/tickspd,line.fix=999,line.fix_anim=0,line.dr=0,grid.dx=0,timer.t=15,timer.visible=!1}function onresize(){cw=canvas.offsetWidth,ch=canvas.offsetHeight,canvas.width=cw,canvas.height=ch,console.log(cw,ch),cellw=Math.floor(cw/(grid.ccount_w+.5))}function drawLine(e){e.save();var i=.7*cellw;e.translate(Math.floor(i),2*cellw),e.strokeStyle="rgba("+line.color[0]+","+line.color[1]+","+line.color[2]+",1)",e.beginPath();for(d=0;d<line.points.length-1;d++)d*cellw/10*tickspd-grid.dx>=0&&e.lineTo(d*cellw/10*tickspd-grid.dx,line.points[d]);var l,o;l=(d-1+line.mx)*cellw/10*tickspd-grid.dx,o=line.last,e.lineTo(l,o),e.stroke(),e.lineTo(l,ch/2),e.lineTo(0,ch/2),e.closePath();var t=e.createLinearGradient(0,-ch/2,0,ch/2);t.addColorStop(0,"rgba("+line.color[0]+","+line.color[1]+","+line.color[2]+",0.2)"),t.addColorStop(1,"rgba("+line.color[0]+","+line.color[1]+","+line.color[2]+",0)"),e.fillStyle=t,e.fill(),e.beginPath(),e.arc(l,o,10,0,2*Math.PI);var n=e.createRadialGradient(l,o,2,l,o,10);n.addColorStop(0,"rgba("+line.pnt_color[0]+","+line.pnt_color[1]+","+line.pnt_color[2]+",1)"),n.addColorStop(.3,"rgba("+line.pnt_color[0]+","+line.pnt_color[1]+","+line.pnt_color[2]+",0.2)"),n.addColorStop(1,"rgba("+line.pnt_color[0]+","+line.pnt_color[1]+","+line.pnt_color[2]+",0)"),e.fillStyle=n,e.fill(),e.beginPath(),e.lineTo(0,o),e.lineTo(.1*-i,o-.03*ch),e.lineTo(1-i,o-.03*ch),e.lineTo(1-i,o+.03*ch),e.lineTo(.1*-i,o+.03*ch),e.lineTo(0,o),e.lineTo(cw,o),(t=e.createLinearGradient(-i,0,cw,0)).addColorStop(0,"rgba(200,200,200,1)"),t.addColorStop(.077,"rgba(200,200,200,1)"),t.addColorStop(.077,"rgba(250,250,250,0.4)"),t.addColorStop(.6,"rgba(250,250,250,0.4)"),t.addColorStop(.8,"rgba(250,250,250,0)"),t.addColorStop(1,"rgba(250,250,250,0)"),e.strokeStyle=t,e.fillStyle="rgba(30,30,30,1)",e.stroke(),e.fill(),e.fillStyle="rgba(255,255,255,1)";var r=(quotes[quotes.current]*(1-16e-6*o)).toString().slice(0,7);if(e.font="7pt Arial",e.textBaseline="middle",e.textAlign="center",e.fillText(r,-i/2,o),999!=line.fix){var a=timer.x*tickspd*cellw/10,c=(timer.x*tickspd+15)*cellw/10-a;e.moveTo(a,line.fix),e.beginPath();for(var d=0;d<20;d+=2)e.moveTo(a+c*d/20,line.fix),e.lineTo(a+c*(d+1)/20,line.fix);(t=e.createLinearGradient(a,0,a+c,0)).addColorStop(0,"rgba("+line.fix_color[0]+","+line.fix_color[1]+","+line.fix_color[2]+",1)"),t.addColorStop(line.fix_anim,"rgba("+line.fix_color[0]+","+line.fix_color[1]+","+line.fix_color[2]+",1)"),t.addColorStop(line.fix_anim,"rgba("+line.fix_color[0]+","+line.fix_color[1]+","+line.fix_color[2]+",0)"),t.addColorStop(1,"rgba("+line.fix_color[0]+","+line.fix_color[1]+","+line.fix_color[2]+",0)"),e.strokeStyle=t,e.stroke(),e.beginPath(),e.arc(a,line.fix,8,0,2*Math.PI),(n=e.createRadialGradient(timer.x*tickspd*cellw/10,line.fix,2,timer.x*tickspd*cellw/10,line.fix,8)).addColorStop(0,"rgba("+line.fix_color[0]+","+line.fix_color[1]+","+line.fix_color[2]+",1)"),n.addColorStop(.3,"rgba("+line.fix_color[0]+","+line.fix_color[1]+","+line.fix_color[2]+",0.2)"),n.addColorStop(1,"rgba("+line.fix_color[0]+","+line.fix_color[1]+","+line.fix_color[2]+",0)"),e.fillStyle=n,e.fill(),e.beginPath();var s=line.fix_anim<1?0:1;e.arc(a+c,line.fix,8*s,0,2*Math.PI),(n=e.createRadialGradient(a+c,line.fix,2,a+c,line.fix,8)).addColorStop(0,"rgba("+line.fix_color[0]+","+line.fix_color[1]+","+line.fix_color[2]+",1)"),n.addColorStop(.3,"rgba("+line.fix_color[0]+","+line.fix_color[1]+","+line.fix_color[2]+",0.2)"),n.addColorStop(1,"rgba("+line.fix_color[0]+","+line.fix_color[1]+","+line.fix_color[2]+",0)"),e.fillStyle=n,e.fill()}e.restore()}function drawGrid(e){e.clearRect(0,0,cw,ch),e.save(),e.fillStyle="rgba(40,40,40,0.2)",e.strokeStyle="rgba(100,100,100,0.5)",e.fillStyle="rgba(100,100,100,1)",e.font="7.5pt Arial",e.translate(Math.floor(.7*cellw),0),e.beginPath();for(r=0;r<grid.ccount_w+4;r++)if(Math.floor(r*cellw-grid.dx)>=0&&(e.moveTo(Math.floor(r*cellw-grid.dx)+.5,0),e.lineTo(Math.floor(r*cellw-grid.dx)+.5,(grid.ccount_h+.15)*cellw),r%3==0)){var i=new Date(now);i.setSeconds(i.getSeconds()+30*r/3),e.fillText(i.toLocaleTimeString("en-GB"),Math.floor(r*cellw-grid.dx)+.05*cellw,.99*ch)}e.moveTo(0,0),e.font="7.5pt Arial",e.textBaseline="top";for(r=0;r<grid.ccount_h+1;r++){e.moveTo(.15*-cellw,Math.floor(r*cellw)+.5),e.lineTo(cw,Math.floor(r*cellw)+.5);var l=(quotes[quotes.current]*(1+.001*(2-r))).toString().slice(0,7);e.fillText(l,.7*-cellw,Math.floor(r*cellw))}e.closePath();var o=e.createLinearGradient(0,0,cw,0);o.addColorStop(0,"rgba(100,100,100,0.5)"),o.addColorStop(.6,"rgba(100,100,100,0.5)"),o.addColorStop(.75,"rgba(100,100,100,0)"),o.addColorStop(1,"rgba(100,100,100,0)"),e.strokeStyle=o,e.stroke(),e.moveTo(0,0),e.beginPath();for(r=0;r<4*(grid.ccount_w+3)+1;r++)Math.floor(r*cellw/4-grid.dx)>=0&&(e.moveTo(Math.floor(r*cellw/4-grid.dx)+.5,0),e.lineTo(Math.floor(r*cellw/4-grid.dx)+.5,grid.ccount_h*cellw));e.moveTo(0,0);for(r=0;r<4*grid.ccount_h+1;r++)e.moveTo(0,Math.floor(r*cellw/4)+.5),e.lineTo(cw,Math.floor(r*cellw/4)+.5);if(e.closePath(),(o=e.createLinearGradient(0,0,cw,0)).addColorStop(0,"rgba(100,100,100,0.1)"),o.addColorStop(.6,"rgba(100,100,100,0.1)"),o.addColorStop(.85,"rgba(100,100,100,0)"),o.addColorStop(1,"rgba(100,100,100,0)"),e.strokeStyle=o,e.stroke(),timer.visible){e.beginPath();var t=Math.round((timer.x*tickspd+15)*cellw/10-grid.dx)+.5;e.moveTo(t,0);for(var n=40,r=0;r<n;r+=2)e.moveTo(t,grid.ccount_h*cellw*r/n),e.lineTo(t,grid.ccount_h*cellw*(r+1)/n);e.strokeStyle="rgba(255,255,255,1)",e.stroke();var a=timer.t>=9?Math.ceil(timer.t):"0"+Math.ceil(timer.t);e.font="10pt HelveticaNeueCyr",e.textBaseline="top",e.textAlign="center",e.fillStyle="rgba(255,255,255,1)",e.fillText("ДО ЗАКРЫТИЯ",t+.1*cw,2),e.fillText("СДЕЛКИ:",t+.1*cw,.07*ch),e.font="Bold 15pt HelveticaNeueCyr",timer.t<=5?e.fillStyle="rgba(200,0,0,1)":e.fillStyle="rgba(255,255,255,1)",e.fillText("00:"+a,t+.1*cw,.15*ch),e.beginPath(),t=Math.round(timer.x*tickspd*cellw/10-grid.dx)+.5,e.moveTo(t,0);for(var n=40,r=0;r<n;r+=2)e.moveTo(t,grid.ccount_h*cellw*r/n),e.lineTo(t,grid.ccount_h*cellw*(r+1)/n);e.strokeStyle="rgba(255,255,255,1)",e.stroke()}e.restore()}function loop(){drawGrid(ctx),drawLine(ctx),window.requestAnimFrame(loop)}var canvas,ctx,cw,ch,grid={},now,line={},cellw,quotes,timer={},bt_grn,bt_red,vid_grad,tickspd,qbtns;line.push_point=function(e){line.points.length>=line.max&&0==grid.dx&&(grid.anim=TweenLite.to(grid,1,{dx:.35*cw,ease:Power0.easeInOut,onComplete:function(){grid.dx=0,line.points.splice(0,30/tickspd)}})),e||(e=1);for(var i=line.points[line.points.length-1]+(50*Math.random()-25)*e+line.dr;(i>line.fix+80||i<line.fix-80)&&0!=line.dr;)i=line.points[line.points.length-1],console.log(i);line.last=i,Math.abs(i)<.4*ch?(TweenLite.from(line,tickspd,{mx:0,last:line.points[line.points.length-1],ease:Power1.easeIn}),line.points.push(i)):line.push_point(e)},window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/30)};